
<p> Display Stuff </p>
<canvas id="ctx" width = "600" height = "1000" style = "border:1px solid #000000;"></canvas>

<script src="/socket.io/socket.io.js"></script>

<script>
	//Getting the socket and the document variables
    var socket = io();
    var ctx = document.getElementById("ctx").getContext("2d");
	
    //Preparing all of the images and saving them in a list
    var Img = {};
    Img.block = new Image()
    Img.block.src = '/client/img/Greyblock.png';
    
	//The Block class, remembers position and color
	var Block = function(NColor, position){ 
		var self = {
			color:Ncolor,
			x: position.x,
			y: position.y,
            id: Math.random(),
		}
		self.draw = function(){
			//draw the block here
		    ctx.drawImage(Img.block, x, y, 50, 50);
		}
        return self;
	
	}
    
    //Preparing a list of all blocks to keep track of.
	Block.list = {}
    
    
    //The Peice class, holds a list of all blocks.
	var Peice = function(data){
		var self = {
			blocks:data.blockList,
		
		}
		
        self.draw = function(dir){
            for(var i in self.blocks){
                self.blocks[i].draw();
            }
        }
        
		self.move = function(dir){
			for(var i in self.blocks){
                block = self.blocks[i]
                
				switch(dir){
					case 'left':
						block.x--;
					case 'right':
						block.x++;
					case 'up':
						block.y--;
					case 'down':
						block.y++;
				}
				
			}

		}
	
	}
	
    //Preparing a 'peice' object to hold all the peice data.
    Peice.active = Peice({blockList:{}})
    
    //Creating an Update function that redraws everything with new data
    var Update = function(){
    
        for(var i in Blocks.list){
            Blocks.list[i].draw();
        }
        
        Peice.active.draw();
    
    }
    
    
	//Socket Functions

	//Updates the active peices position`
    socket.on('activeUpdate', function(data){
        self.move(data.dir);
        Update();
    });
    
	//deletes a saved row of blocks
	socket.on('deleteRow', function(data){
		for(var i in Blocks.list){
            var block = Blocks.list[i];
            
            if(block.y = data.row){
                delete Blocks.list[i];
            }
            else if(block.y > data.row){
                block.y--;
            }
        }
        Update();
        
	});
	//Take the active block and makes it a normal one.
	socket.on('setActive', function(data){
		for(var i in Peice.active.blocks){
            var block = Peice.active.blocks[i];
            
            Blocks.list[block.id] = block;
        }
        
        newBlockList = {}
        var val;
        var count = 0;
        for(var i = 0; i < data.active.length; i++){
            
            val = data.active[i];
                
            while(val > 0){
            
                if(val & 1 > 0){
                   var newBlock = Block(data.color,{x:10-count, y:i});
                   newBlockList[newBlock.id] = newBlock;
                }
                val = val >> 1;
                count++;
            }
        }
        
        Peice.active = Peice({blockList:newBlockList});
        
	});
	
	
	
</script>